@using Microsoft.AspNetCore.Components.Routing
@using RestaurantApp.Web.Services
@inject NotificationService NotificationService
@inject SidebarService SidebarService
@inject NavigationManager Navigation
@inject IJSRuntime JS
@rendermode InteractiveServer

<aside class="sidebar @(SidebarService.IsDesktopCollapsed ? "collapsed" : "") @(SidebarService.IsSidebarOpen ? "mobile-open" : "")">
    <div class="sidebar-header">
        <div class="brand">
            <i class="bi bi-shop"></i>
            <span class="brand-text">Restaurant</span>
        </div>
        <button class="toggle-btn" @onclick="SidebarService.ToggleDesktop">
            <i class="bi @(SidebarService.IsDesktopCollapsed ? "bi-chevron-right" : "bi-chevron-left")"></i>
        </button>
    </div>

    <nav class="sidebar-nav">
        <ul class="nav-list">
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin" Match="NavLinkMatch.All">
                    <i class="bi bi-speedometer2"></i>
                    <span>Dashboard</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/orders">
                    <i class="bi bi-receipt"></i>
                    <span>Orders</span>
                    @if (NotificationService.PendingOrdersCount > 0)
                    {
                        <span class="badge bg-danger">@NotificationService.PendingOrdersCount</span>
                    }
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/kitchen">
                    <i class="bi bi-fire"></i>
                    <span>Kitchen</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/menu">
                    <i class="bi bi-menu-button-wide"></i>
                    <span>Menu</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/categories">
                    <i class="bi bi-grid"></i>
                    <span>Categories</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/branches">
                    <i class="bi bi-building"></i>
                    <span>Branches</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/offers">
                    <i class="bi bi-tags"></i>
                    <span>Offers</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/users">
                    <i class="bi bi-people"></i>
                    <span>Users</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/reviews">
                    <i class="bi bi-star"></i>
                    <span>Reviews</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/loyalty">
                    <i class="bi bi-gift"></i>
                    <span>Loyalty</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/deliveries">
                    <i class="bi bi-truck"></i>
                    <span>Deliveries</span>
                </NavLink>
            </li>
            <li class="nav-item">
                <NavLink class="nav-link" href="/admin/reports">
                    <i class="bi bi-graph-up"></i>
                    <span>Reports</span>
                </NavLink>
            </li>
        </ul>
    </nav>

    <div class="sidebar-footer">
        <NavLink class="nav-link" href="/admin/settings">
            <i class="bi bi-gear"></i>
            <span>Settings</span>
        </NavLink>
    </div>
</aside>

@code {
    protected override void OnInitialized()
    {
        NotificationService.OnChange += StateHasChanged;
        SidebarService.OnChange += StateHasChanged;
        Navigation.LocationChanged += HandleLocationChanged;
    }

    private void HandleLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        SidebarService.CloseMobile();
    }

    public void Dispose()
    {
        NotificationService.OnChange -= StateHasChanged;
        SidebarService.OnChange -= StateHasChanged;
        Navigation.LocationChanged -= HandleLocationChanged;
    }
}
